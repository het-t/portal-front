"use strict";(self["webpackChunkportal"]=self["webpackChunkportal"]||[]).push([[57],{4057:function(s,t,e){e.r(t),e.d(t,{default:function(){return Rs}});var i=e(6252),a=e(9963),o=e(3577);const l=s=>((0,i.dD)("data-v-cec64974"),s=s(),(0,i.Cn)(),s),n={class:"card"},d={class:"table-tabs"},r={class:"fg pl16"},u={class:"mb16"},c={class:"row"},p=["for"],k=["id"],h={class:"row mt8"},m=["for"],b={class:"row mt8"},g=["for"],f={class:"row mt8"},_=["for"],T={class:"row mt8"},v=["for"],w=["value","id"],y={class:"row mt8"},C=["for"],I=["value","id"],S={ref:"UsersExtra",style:{display:"inline"}},x={class:"row mt8"},D=["for"],V={class:"row mt8"},U=["for"],$=["id"],M=["value"],N={class:"row mt8"},z=["for"],A=["id"],q={class:"row mt8"},L=["for"],O=["id"],P={key:0,class:"row mt8"},F=["for"],K=["id"],R={class:"row mt8"},E=["for"],Z=["id"],W={class:"flex mt16"},G=["id"],J=["for"],H=["id"],Y=l((()=>(0,i._)("option",{value:"year"},"every year",-1))),j=l((()=>(0,i._)("option",{value:"month"},"every month",-1))),B=l((()=>(0,i._)("option",{value:"day"},"every day",-1))),Q=[Y,j,B],X=["id"],ss={class:"flex mt16"},ts=["id"],es=["for"],is=["disabled"],as=["disabled"],os=l((()=>(0,i._)("div",{class:"vr"},null,-1))),ls={class:"fg pr16 sub-tasks-scroll"},ns={class:"row mt8 mb16"},ds=["for"],rs={style:{width:"80%",display:"flex","align-items":"center"}},us=["id"],cs={key:0,class:"grid-wrapper"},ps={key:0,class:"grid"},ks=["onKeyup","onClick"],hs=["onInput"],ms={style:{overflow:"hidden",display:"flex","justify-content":"flex-end"}},bs=["src"],gs={class:"ml16"},fs=["onUpdate:modelValue"],_s=["value"],Ts={class:"ml16"},vs={class:"ml16"},ws=["onUpdate:modelValue","id"],ys={class:"ml16"},Cs=["onUpdate:modelValue"],Is={class:"mr16 ml16 mt16"},Ss=l((()=>(0,i._)("tr",null,[(0,i._)("th",null,"user"),(0,i._)("th",null,"action"),(0,i._)("th",{style:{"border-right":"solid 1px #eeeeee"}},"sub-task"),(0,i._)("th",null,"date")],-1))),xs={key:0},Ds={key:1},Vs={style:{"border-right":"solid 1px #eeeeee"}};function Us(s,t,e,l,Y,j){const B=(0,i.up)("vue-multiselect"),Us=(0,i.up)("font-awesome-icon");return(0,i.wg)(),(0,i.iD)("div",null,[(0,i._)("div",n,[(0,i._)("div",d,[(0,i._)("button",{onClick:t[0]||(t[0]=s=>j.openTab(s,"details")),ref:"defaultTab"+e.uk,class:"button neutral tab"},"details",512),(0,i._)("button",{onClick:t[1]||(t[1]=s=>j.openTab(s,"logs")),class:"button neutral tab"},"logs")]),(0,i._)("div",{class:"fg-wrapper mt16 pb16 pr16 pl16 hide",ref:"details"+e.uk},[(0,i._)("div",r,[(0,i._)("form",u,[(0,i._)("div",null,[(0,i._)("div",c,[(0,i._)("label",{ref:"details"+e.uk+"focus",for:"task-title"+e.uk,class:"labels c1"},"title",8,p),(0,i.wy)((0,i._)("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>Y.taskTitle=s),type:"text",id:"task-title"+e.uk},null,8,k),[[a.nr,Y.taskTitle]])]),(0,i._)("div",h,[(0,i._)("label",{for:"task-client"+e.uk,class:"labels c1"},"client",8,m),(0,i.Wm)(B,{id:"task-client"+e.uk,modelValue:Y.taskClient,"onUpdate:modelValue":t[3]||(t[3]=s=>Y.taskClient=s),options:s.clientsGetConfirmed,"custom-label":j.labelForClient,"track-by":"id",placeholder:"Select Client"},{noResult:(0,i.w5)((()=>[(0,i.Uk)(" Oops! No client found. Consider creating new client ")])),_:1},8,["id","modelValue","options","custom-label"])]),(0,i._)("div",b,[(0,i._)("label",{for:"task-coordinator"+e.uk,class:"labels c1"},"co-ordinator",8,g),(0,i.Wm)(B,{multiple:"",class:"options-list multiselect__tag_bg",id:"task-coordinator"+e.uk,modelValue:Y.taskCoordinator,"onUpdate:modelValue":t[4]||(t[4]=s=>Y.taskCoordinator=s),placeholder:"Select Coordinator",options:s.allUsers,"custom-label":j.labelForCoordinator,"track-by":"id"},{noResult:(0,i.w5)((()=>[(0,i.Uk)(" Oops! No user found. Consider creating new user ")])),option:(0,i.w5)((s=>[(0,i._)("span",{class:(0,o.C_)(["p0 m0",0==s.option.isActive?"not-active":""]),style:{height:"0 !important",width:"0 !important"}},(0,o.zw)(s.option.firstName)+" "+(0,o.zw)(s.option.lastName)+" ("+(0,o.zw)(s.option.id)+") ",3)])),_:1},8,["id","modelValue","options","custom-label"])]),(0,i._)("div",f,[(0,i._)("label",{for:"task-tasks"+e.uk,class:"labels c1"},"task",8,_),(0,i.Wm)(B,{id:"task-tasks"+e.uk,modelValue:Y.taskMasterId,"onUpdate:modelValue":t[5]||(t[5]=s=>Y.taskMasterId=s),placeholder:"Select Task-Master",options:s.tasksMasterListGet,"custom-label":j.labelForTaskMaster,"track-by":"id"},{noResult:(0,i.w5)((()=>[(0,i.Uk)(" Oops! No task-master found. Consider creating new task-master ")])),_:1},8,["id","modelValue","options","custom-label"])]),(0,i.wy)((0,i._)("div",null,[(0,i._)("div",T,[(0,i._)("label",{for:"contactEmail"+e.uk,class:"labels c1"},"Email",8,v),(0,i._)("input",{value:Y.clientContact?.conEmail,id:"contactEmail"+e.uk,disabled:""},null,8,w)]),(0,i._)("div",y,[(0,i._)("label",{for:"contactPhone"+e.uk,class:"labels c1"},"Phone",8,C),(0,i._)("input",{value:Y.clientContact?.conPhone,id:"contactPhone"+e.uk,type:"text",disabled:""},null,8,I)]),(0,i.wy)((0,i._)("div",S,[(0,i._)("div",x,[(0,i._)("label",{for:"extraAssignTo"+e.uk,class:"labels c1"},"Assign To",8,D),(0,i.Wm)(B,{multiple:"",class:"options-list multiselect__tag_bg",id:"extraAssignTo"+e.uk,modelValue:Y.popAssignTo,"onUpdate:modelValue":t[6]||(t[6]=s=>Y.popAssignTo=s),placeholder:"Select user to assign",options:s.allUsers,"custom-label":j.labelForCoordinator,"track-by":"id"},{noResult:(0,i.w5)((()=>[(0,i.Uk)(" Oops! No user found. Consider creating new user ")])),option:(0,i.w5)((s=>[(0,i._)("span",{class:(0,o.C_)(["p0 m0",0==s.option.isActive?"not-active":""])},(0,o.zw)(s.option.firstName)+" "+(0,o.zw)(s.option.lastName)+" ("+(0,o.zw)(s.option.id)+") ",3)])),_:1},8,["id","modelValue","options","custom-label"])]),(0,i._)("div",V,[(0,i._)("label",{class:"labels c1",for:"extraStatus"+e.uk},"Status",8,U),(0,i.wy)((0,i._)("select",{id:"extraStatus"+e.uk,"onUpdate:modelValue":t[7]||(t[7]=s=>Y.popStatusId=s)},[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(Y.subTaskStatuses,(s=>((0,i.wg)(),(0,i.iD)("option",{value:s.id,key:s.id},(0,o.zw)(s.status),9,M)))),128))],8,$),[[a.bM,Y.popStatusId]])]),(0,i._)("div",N,[(0,i._)("label",{class:"labels c1",for:"extraCost"+e.uk},"Cost",8,z),(0,i.wy)((0,i._)("input",{id:"extraCost"+e.uk,"onUpdate:modelValue":t[8]||(t[8]=s=>Y.popCost=s),type:"number",placeholder:"Cost"},null,8,A),[[a.nr,Y.popCost]])]),(0,i._)("div",q,[(0,i._)("label",{class:"labels c1",for:"extraComments"+e.uk},"Comments",8,L),(0,i.wy)((0,i._)("input",{id:"extraComments"+e.uk,"onUpdate:modelValue":t[9]||(t[9]=s=>Y.popComments=s),type:"text",placeholder:"Comments"},null,8,O),[[a.nr,Y.popComments]])])],512),[[a.F8,Y.popupVisible]])],512),[[a.F8,Y.editing]]),1==j.rightCheck("see_pricing")?((0,i.wg)(),(0,i.iD)("div",P,[(0,i._)("label",{for:"task-cost"+e.uk,class:"labels c1"},"fees",8,F),(0,i.wy)((0,i._)("input",{type:"number","onUpdate:modelValue":t[10]||(t[10]=s=>Y.taskCost=s),id:"task-cost"+e.uk},null,8,K),[[a.nr,Y.taskCost]])])):(0,i.kq)("",!0),(0,i._)("div",R,[(0,i._)("label",{for:"task-description"+e.uk,class:"labels c1"},"description",8,E),(0,i.wy)((0,i._)("textarea",{"onUpdate:modelValue":t[11]||(t[11]=s=>Y.taskDescription=s),name:"task-description",id:"task-description"+e.uk,cols:"30",rows:"5",placeholder:"Description"},null,8,Z),[[a.nr,Y.taskDescription]])])]),(0,i._)("div",W,[(0,i.wy)((0,i._)("input",{"onUpdate:modelValue":t[12]||(t[12]=s=>Y.repeat=s),type:"checkbox",id:"recurring"+e.uk,class:"recurring"},null,8,G),[[a.e8,Y.repeat]]),(0,i._)("label",{for:"recurring"+e.uk},"recurring",8,J),Y.repeat?(0,i.wy)(((0,i.wg)(),(0,i.iD)("select",{key:0,"onUpdate:modelValue":t[13]||(t[13]=s=>Y.taskRepeat=s),id:"task-repeat"+e.uk,class:"task-repeat p0 ml8"},Q,8,H)),[[a.bM,Y.taskRepeat]]):(0,i.kq)("",!0),Y.repeat?(0,i.wy)(((0,i.wg)(),(0,i.iD)("input",{key:1,"onUpdate:modelValue":t[14]||(t[14]=s=>Y.taskRepeatOn=s),type:"date",id:"task-repeat-on"+e.uk,class:"task-repeat p0 pl8 ml8"},null,8,X)),[[a.nr,Y.taskRepeatOn]]):(0,i.kq)("",!0)]),(0,i._)("div",ss,[(0,i.wy)((0,i._)("input",{"onUpdate:modelValue":t[15]||(t[15]=s=>Y.save=s),type:"checkbox",id:"save-task-template"+e.uk,class:"save-task-template"},null,8,ts),[[a.e8,Y.save]]),(0,i._)("label",{for:"save-task-template"+e.uk},"save task template for future use ",8,es)]),(0,i._)("button",{disabled:!0===Y.disabled,onClick:t[16]||(t[16]=(0,a.iM)((s=>j.proceed()),["prevent"])),class:"green mt16 button"},"save",8,is),(0,i._)("button",{disabled:!0===Y.disabled,onClick:t[17]||(t[17]=(0,a.iM)((s=>j.canceled()),["prevent"])),class:"neutral ml8 mt16 button"},"cancel",8,as)])]),os,(0,i._)("div",ls,[(0,i._)("div",null,[(0,i._)("div",ns,[(0,i._)("label",{for:"task-sub-task"+e.uk,class:"labels c1"},"sub task",8,ds),(0,i._)("div",rs,[(0,i.wy)((0,i._)("input",{onKeyup:t[18]||(t[18]=(0,a.D2)((s=>j.addSubTask()),["enter"])),"onUpdate:modelValue":t[19]||(t[19]=s=>Y.newSubTask=s),style:{width:"100%"},type:"text",id:"task-sub-task"+e.uk},null,40,us),[[a.nr,Y.newSubTask]]),(0,i.Wm)(Us,{tabindex:"0",class:"icon pointer add-st ml8",onKeyup:t[20]||(t[20]=(0,a.D2)((s=>j.addSubTask()),["enter"])),onClick:t[21]||(t[21]=(0,a.iM)((s=>j.addSubTask()),["prevent"])),icon:"fa-solid fa-plus"})])])]),Y.subTasks?((0,i.wg)(),(0,i.iD)("div",cs,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(Y.subTasks,((t,l)=>((0,i.wg)(),(0,i.iD)("div",{key:l,class:"mb8"},["_#_*&^"!=t.description?((0,i.wg)(),(0,i.iD)("div",ps,[(0,i.Wm)(Us,{tabindex:"0",icon:"fa-solid fa-minus",onKeyup:(0,a.D2)((s=>j.removeSubTask(l)),["enter"]),onClick:(0,a.iM)((s=>j.removeSubTask(l)),["prevent"]),class:"pointer icon rmst"},null,8,["onKeyup","onClick"]),(0,i._)("div",{class:"pointer",tabindex:"0",onKeyup:(0,a.D2)((s=>j.toggleDisplaySubTask(l)),["enter"]),onClick:(0,a.iM)((s=>j.toggleDisplaySubTask(l)),["prevent"])},[(0,i._)("p",{contentEditable:"true",class:(0,o.C_)(["st-description",5==t.statusId||6==t.statusId?"done-st":""]),onInput:s=>j.updateSubTaskTitle(t,s)},(0,o.zw)(t.description),43,hs),void 0!=t?.status?((0,i.wg)(),(0,i.iD)("span",{key:0,class:(0,o.C_)(["ml8 st_status",t.status])},(0,o.zw)(t.status),3)):(0,i.kq)("",!0)],40,ks),(0,i._)("div",ms,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(t.assignedTo,((e,a)=>((0,i.wg)(),(0,i.iD)("div",{key:e.id,style:(0,o.j5)([j.getStyle(t.assignedTo.length-a-1),{height:"36px",width:"36px","clip-path":"circle()",position:"relative","background-color":"white"}])},[void 0==s.$store.getters["images/getProfilePic"](`${e.id}_50x50`)||""==s.$store.getters["images/getProfilePic"](`${e.id}_50x50`)?((0,i.wg)(),(0,i.j4)(Us,{key:e.id,class:"profile-pic",style:{"border-radius":"100%",width:"36px",height:"36px"},icon:["fas","user"]})):((0,i.wg)(),(0,i.iD)("img",{key:1,src:s.$store.getters["images/getProfilePic"](`${e.id}_50x50`),loading:"lazy",style:{width:"36px",height:"36px"}},null,8,bs))],4)))),128))])])):(0,i.kq)("",!0),"_#_*&^"!=t.description&&Y.show==l?((0,i.wg)(),(0,i.iD)("div",{key:1,class:(0,o.C_)(["hide ml24",Y.show==l?"show":"hide"])},[(0,i._)("div",gs,[(0,i.wy)((0,i._)("select",{"onUpdate:modelValue":s=>t.statusId=s,class:"sub-task-extra"},[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(Y.subTaskStatuses,((s,t)=>((0,i.wg)(),(0,i.iD)("option",{value:s.id,key:t.toString()+e.uk},(0,o.zw)(s.status),9,_s)))),128))],8,fs),[[a.bM,t.statusId]])]),(0,i._)("div",Ts,[(0,i.Wm)(B,{multiple:"",modelValue:t.assignedTo,"onUpdate:modelValue":s=>t.assignedTo=s,options:s.allUsers,"custom-label":j.labelForCoordinator,"track-by":"id",placeholder:"Assigend To",class:"sub-task-extra options-list multiselect__tag_bg"},{noResult:(0,i.w5)((()=>[(0,i.Uk)(" Oops! No user found. Consider creating new user ")])),option:(0,i.w5)((s=>[(0,i._)("span",{class:(0,o.C_)(["p0 m0",0==s.option.isActive?"not-active":""]),style:{height:"0 !important",width:"0 !important"}},(0,o.zw)(s.option.firstName)+" "+(0,o.zw)(s.option.lastName)+" ("+(0,o.zw)(s.option.id)+") ",3)])),_:2},1032,["modelValue","onUpdate:modelValue","options","custom-label"])]),(0,i._)("div",vs,[(0,i.wy)((0,i._)("input",{"onUpdate:modelValue":s=>t.cost=s,type:"number",id:"sub-task-cost"+e.uk,placeholder:"Cost",class:"sub-task-extra"},null,8,ws),[[a.nr,t.cost]])]),(0,i._)("div",ys,[(0,i.wy)((0,i._)("input",{"onUpdate:modelValue":s=>t.comments=s,class:"sub-task-extra",type:"text",placeholder:"Comments"},null,8,Cs),[[a.nr,t.comments]])])],2)):(0,i.kq)("",!0)])))),128))])):(0,i.kq)("",!0)])],512)]),(0,i._)("div",{class:"card hide",ref:"logs"+e.uk},[(0,i._)("div",Is,[(0,i._)("table",null,[Ss,((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(s.taskData(e.editTaskId)?.tasksLogs,((s,t)=>((0,i.wg)(),(0,i.iD)("tr",{key:t,class:"tr"},[(0,i._)("td",null,(0,o.zw)(s.user),1),(0,i._)("td",null,[(0,i.Uk)((0,o.zw)(s.action+" "+s.key)+" ",1),null!=s.after?((0,i.wg)(),(0,i.iD)("span",xs," to "+(0,o.zw)(s.after),1)):(0,i.kq)("",!0),null!=s.before?((0,i.wg)(),(0,i.iD)("span",Ds," from "+(0,o.zw)(s.before),1)):(0,i.kq)("",!0)]),(0,i._)("td",Vs,(0,o.zw)("_#_*&^"!=s?.subTask&&s?.subTask?s.subTask:"Not Available"),1),(0,i._)("td",null,(0,o.zw)(new Date(s.timestamp).toLocaleString()),1)])))),128))])])],512)])}var $s=e(6737),Ms=e.n($s),Ns=e(3907),zs=e(4754),As=e(4802),qs=e(3262),Ls=e(2444),Os=e(665),Ps={name:"TasksCreate",props:["editTaskId","uk"],components:{VueMultiselect:Ls.ZP},data(){return{editing:!1,subTaskStatuses:[{id:1,status:"hold"},{id:2,status:"to do"},{id:3,status:"in progress"},{id:4,status:"pending for approval"},{id:5,status:"done"},{id:6,status:"cancel"},{id:7,status:"pending with client"},{id:8,status:"signed documents awaited"},{id:9,status:"pending for DSC"},{id:10,status:"reassigned"},{id:11,status:"approved"},{id:12,status:"Pending before authority"}],subTasks:[],removedSubTasksId:[],taskMasterId:"",repeat:!1,newSubTask:"",taskTitle:"",taskDescription:"",taskClient:"",taskCost:"",taskCoordinator:[],save:!1,taskRepeat:"",taskRepeatOn:"",clientContact:"",taskLogs:[],disabled:!1,i:0,show:-1,popupVisible:!1,popAssignTo:[],popComments:"",popCost:"",popStatusId:"",unqId:0}},computed:{...(0,Ns.Se)("tasks",["taskData","subTasksData","tasksMasterListGet"]),...(0,Ns.Se)("users",["allUsers"]),...(0,Ns.Se)("clients",["clientsGetConfirmed"])},watch:{taskMasterId(s,t){if(""==t&&(t=void 0),""==s&&(s=void 0),0!=this.i){if(1==this.editing){let s=this.subTasks?.map((s=>s?.id));0!=s?.length&&this.removedSubTasksId?.push(...s)}this.taskMasterSelected(s?.id)}else 0==this.i&&(1!=this.editing?this.taskMasterSelected(s?.id):++this.i)}},methods:{rightCheck:Os.Z,getStyle(s){return`left: ${8*s}px;`},labelForCoordinator({firstName:s,lastName:t,id:e}){return`${s} ${t} (${e})`},labelForClient({name:s,id:t}){return`${s} (${t})`},labelForTaskMaster({title:s,id:t}){return`${s} (${t})`},taskMasterSelected(s){if(s?.id&&(s=s.id),void 0==s)return this.taskCost="",void(this.subTasks=[]);++this.i;const t=this["tasksMasterListGet"].find((t=>t.id==s));zs.K_.get({taskMasterId:s}).then((s=>{this.subTasks=s.data.subTasksMasterList,this.taskCost=t?.cost}))},openTab(s,t){var e=s.target.parentElement.getElementsByClassName("tab");let i=[...e].find((s=>1==s?.classList?.contains("tab-open")));i?.classList?.remove("tab-open"),s?.target?.classList?.add("tab-open"),this.$refs["details"+this.uk]?.classList?.add("hide"),this.$refs["logs"+this.uk]?.classList?.add("hide"),this.$refs[t+this.uk]?.classList?.remove("hide"),this.$refs["details"+this.uk+"focus"].focus()},addSubTask(){++this.unqId,this.subTasks.push({unqId:this.unqId,description:this.newSubTask,statusId:2,assignedTo:[],comments:"",cost:""}),document.getElementById("task-sub-task"+this.uk).focus(),this.newSubTask="",0==this.subTasks?.length||1==this.subTasks.length&&"_#_*&^"==this.subTasks[0].description?this.popupVisible=!0:this.popupVisible=!1},removeSubTask(s){const t=this.subTasks.splice(s,1);t[0]?.id&&this.removedSubTasksId.push(t[0]?.id),0==this.subTasks?.length||1==this.subTasks.length&&"_#_*&^"==this.subTasks[0].description?this.popupVisible=!0:this.popupVisible=!1},updateSubTaskTitle(s,t){for(let e=0;e!=this.subTasks.length;e++)(this.subTasks[e]?.id==s.id&&void 0!=s.id||this.subTasks[e]?.unqId==s.unqId&&void 0!=s.unqId)&&(this.subTasks[e].description=t.target.innerText)},toggleDisplaySubTask(s){this.show==s?this.show=-1:this.show=s},populateDataProperties(s){const{taskMasterId:t,title:e,description:i,cost:a,clientId:o}=s,l=JSON.parse(s.coordinatorIds),n=this.clientsGetConfirmed.find((s=>s.id==o));this.taskTitle=e,this.taskDescription=i,this.taskCost=a,null!==l?.[0]&&(this.taskCoordinator=l?.map((s=>this.allUsers.find((t=>t.id==s))))),this.taskClient=n,this.taskMasterId=this.tasksMasterListGet.find((s=>s.id==t)),this.clientContact=n},proceed(){this.disabled=!0,this.subTasks?.map((s=>{s.assignedTo?.length>0&&(s.assignedTo=s.assignedTo.map((s=>s?.id?s.id:s)))})),this.taskCoordinator=this.taskCoordinator?.length>0?this.taskCoordinator?.map((s=>{if(s?.id)return s.id})):[];let s,t={saved:new Number(this.save),taskId:this.editTaskId,taskMasterId:this.taskMasterId,title:this.taskTitle,description:this.taskDescription,cost:this.taskCost,clientId:this.taskClient,coordinatorIds:JSON.stringify(this.taskCoordinator),subTasks:JSON.stringify(this.subTasks),removedSubTasks:JSON.stringify(this.removedSubTasksId)};0==this.subTasks?.length&&0===this.popAssignTo.length&&""==this.popComments&&""==this.popCost&&""==this.popStatusId?(this.popupVisible=!0,s=Ms()({content:this.$refs["UsersExtra"],buttons:!0}).then((s=>{if(null==s)throw null;return{assignedTo:this.popAssignTo.map((s=>{if(s?.id)return s.id})),cost:this.popCost,comments:this.popComments,statusId:this.popStatusId}})).then((s=>{this.subTasks=[{description:"_#_*&^",assignedTo:s.assignedTo,statusId:s.statusId||2,comments:s.comments,cost:s.cost}],t.subTasks=JSON.stringify(this.subTasks)}))):1==this.subTasks?.length&&"_#_*&^"==this.subTasks[0]?.description?(this.subTasks[0].assignedTo=this.popAssignTo.map((s=>{if(s?.id)return s.id})),this.subTasks[0].comments=this.popComments,this.subTasks[0].statusId=this.popStatusId||2,this.subTasks[0].cost=this.popCost,t.subTasks=JSON.stringify(this.subTasks),s=Promise.resolve()):s=Promise.resolve(),t.clientId?.id&&(t.clientId=t.clientId?.id),t.taskMasterId?.id&&(t.taskMasterId=t.taskMasterId.id),s.then((()=>{1==this.editing?(0,As.Z)({text:t.title,mutationFnName:"tasks/refetch",mutationArgs:{saved:t.saved,taskId:t.taskId},promise:zs.wq.edit(t),context:this}):(0,qs.Z)({text:t.title,mutationFnName:"tasks/refetch",mutationArgs:{saved:t.saved},url:"/u/tasks/list",promise:zs.wq.create(t),context:this})})).catch((s=>{null==s&&this.canceled()})),this.$store.commit("myTasks/refetch")},canceled(){1==this.editing?this.$emit("editingCompleted",{force:!0}):this.$router.push("/u/tasks/list")}},created(){this.$store.dispatch("clients/clientsGetConfirmed"),this.$store.dispatch("tasks/tasksMasterListSet"),this.$store.dispatch("users/usersAll"),(void 0!=window.history.state.taskId||void 0!=this.editTaskId)&&(this.editing=!0)},mounted(){if(1==this.editing){const s=this["taskData"](this.editTaskId)?.taskData?.[0],t=this["taskData"](this.editTaskId)?.taskLogs,e=this["subTasksData"](this.editTaskId);if(void 0!==s&&""!==s&&(this.populateDataProperties(s),this.taskLogs=t),void 0!==e&&""!==e){this.unqId=e.length;for(let s=0;s<e.length;s++)"number"===typeof e[s].assignedTo?.[0]?e[s].assignedTo=e[s].assignedTo.map((s=>this.allUsers.find((t=>t.id==s)))):null===e[s].assignedTo&&(e[s].assignedTo=[]);this.subTasks=e}1===this.subTasks?.length&&"_#_*&^"==this.subTasks[0].description&&(this.popupVisible=!0,this.popAssignTo=this.subTasks[0].assignedTo,this.popComments=this.subTasks[0].comments,this.popCost=this.subTasks[0].cost,this.popStatusId=this.subTasks[0].statusId)}this.$refs["defaultTab"+this.uk].click()}},Fs=e(3744);const Ks=(0,Fs.Z)(Ps,[["render",Us],["__scopeId","data-v-cec64974"]]);var Rs=Ks},665:function(s,t,e){e.d(t,{Z:function(){return a}});var i=e(2283);function a(s){const t=i.Z.getters["rights/getUserRights"],e=t?.some((t=>t.code_name==s));return e}},3262:function(s,t,e){function i({text:s,url:t,mutationFnName:e,mutationArgs:i,promise:a,context:o}){let l=i;void 0==l&&(l={}),a.then((()=>o.$toast.success(`saved ${s}`))).then((()=>{e&&o.$store.commit(e,l),setTimeout((()=>o.$router.push(t)),1)})).catch((s=>{null!=s&&o.$toast.error("Oops! We can't perform this action right now")})).finally((()=>{o.disabled=!1}))}e.d(t,{Z:function(){return i}})},4802:function(s,t,e){e.d(t,{Z:function(){return a}});var i=e(2283);function a({text:s,mutationFnName:t,mutationArgs:e,promise:a,context:o}){a.then((()=>{t&&i.Z.commit(t,e),o.$emit("editingCompleted",{}),o.$toast.success(`Saved ${s}`)})).catch((s=>{if(null!=s)return o.$toast.error("Oops! We can't perform this action right now")})).finally((()=>{o.disabled=!1,void 0!=o?.polling&&(o.polling=!0)}))}}}]);
//# sourceMappingURL=57.d3f05690.js.map